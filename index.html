<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script type="application/javascript">
        var x = 5;
        var y = 595;
        var requestId = 0;
        var stopAnimation = false;
        var velocity = 0;
        var angle = 0;
        var G = 9.81; //acceleration due gravity
        var Vx = 0;
        var Vy = 0;
        var firstTime = true;
        var maxHeight = 0;
        var xOld = 0;
        var yOld = 0;

        function calculateStats(speed, angleOfLaunch) {
            var distance = 0;
            var radians = angleOfLaunch * Math.PI /
                180; // convert to radians because cos and sin methods need the angle to be radians
            Vx = speed * Math.cos(radians);
            Vy = speed * Math.sin(radians);
            distance = ((speed * speed) * Math.sin(2 * radians)) / G;
            document.getElementById("xAxis").innerHTML = "Distance in X Axis is " + distance + " meters";
            maxHeight = ((speed * speed) * (Math.sin(radians) * Math.sin(radians))) / (2 * G);
            console.log(maxHeight);
        }

        function start() {
            if (firstTime) {
                velocity = document.getElementById('velocity').value; //TO DO handle user inputs
                angle = document.getElementById('angle').value;
                calculateStats(velocity, angle);
                stopAnimation = false;
                draw();
            } else {
                reset();
                velocity = document.getElementById('velocity').value; //TO DO handle user inputs
                angle = document.getElementById('angle').value;
                calculateStats(velocity, angle);
                stopAnimation = false;
                draw();

            }
        }

        function clearStats() {
            stopAnimation = true;
            velocity = 0;
            angle = 0;
            Vx = 0;
            Vy = 0;
            firstTime = true;
        }

        function reset() {
            x = 5;
            y = 595;
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            window.cancelAnimationFrame(requestId);
            clearStats();
        }


        function calculateLastPoint() {
            finalPoint = (((600 - yOld) / (y - yOld)) * (x - xOld)) + xOld;
            return finalPoint;
        }

        function draw() { //To Do change global variables to arguments passing
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            Vy = Vy - G;
            if (firstTime) {
                firstTime = false;
            } else {
                x = x + Vx;
                y = y - Vy;
            }
            console.log("Value of x  = ", x);
            console.log("Value of y  = ", y);
            document.getElementById("yAxis").innerHTML = "Distance in Y Axis is " + y;
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, 2 * Math.PI);
            ctx.fill();

            if ((x > 1495) || (y <= 0)) {
                window.cancelAnimationFrame(requestId);
                stopAnimation = true;
                firstTime = true;

                console.log("should have stopped");

            } else if (y > 600) {
                if ( yOld<594){
                var finalPoint = 0;
                finalPoint = calculateLastPoint();
                ctx.beginPath();
                ctx.arc(finalPoint, 600, 5, 0, 2 * Math.PI);
                ctx.fill();
            }
                window.cancelAnimationFrame(requestId);
                stopAnimation = true;

            }
            xOld = x;
            yOld = y;
            if (!stopAnimation) {
                setTimeout(function () {
                    requestId = window.requestAnimationFrame(draw)
                }, 100);
            }
        }
    </script>
    <style type="text/css">
        canvas {
            border: 1px solid black;
        }

        .userInput {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="userInput">
            <input id="velocity" type="text" placeholder="Enter the Velocity"></input>
            <input id="angle" type="text" placeholder="Enter the projection angle"></input>
            <input id="Launch" type="button" value="Launch" onclick="start();" />
            <input id="Reset" type="button" value="Reset" onclick="reset();" />
        </div>
        <div class="representation">
            <canvas id="canvas" width="1500" height="600"></canvas>
        </div>
        <div class="coordinates">
            <p id="xAxis">Distance in X axis </p>
            <p id="yAxis">Distance in Y axis </p>
        </div>
    </div>
</body>

</html>